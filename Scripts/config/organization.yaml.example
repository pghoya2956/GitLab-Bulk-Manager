# GitLab Organization Structure Configuration (YAML)
# Complete organization setup including groups, projects, members, and settings

# Organization metadata
organization:
  name: "TechCorp"
  description: "Technology Corporation GitLab Structure"
  created_by: "DevOps Team"
  version: "1.0.0"

# Base configuration
config:
  # Parent group ID where entire structure will be created
  # Set to null to create at root level
  parent_id: null
  
  # GitLab instance settings
  gitlab_url: "https://gitlab.example.com"
  
  # Default settings inherited by all groups
  group_defaults:
    visibility: private
    request_access_enabled: true
    project_creation_level: developer
    subgroup_creation_level: maintainer
    lfs_enabled: true
    
  # Default settings inherited by all projects
  project_defaults:
    visibility: private
    issues_enabled: true
    wiki_enabled: true
    merge_requests_enabled: true
    default_branch: main
    initialize_with_readme: true

# Hierarchical group structure
groups:
  - name: "개발본부"
    path: "dev-division"
    description: "개발 조직"
    visibility: internal
    
    # Group-level settings
    settings:
      two_factor_requirement: true
      require_two_factor_authentication: true
      two_factor_grace_period: 48
      
    # Members to add to this group
    members:
      - username: "john.doe"
        access_level: owner
      - username: "jane.smith"
        access_level: maintainer
        expires_at: "2024-12-31"
        
    # Projects in this group
    projects:
      - name: "dev-standards"
        description: "개발 표준 문서"
        topics: ["documentation", "standards"]
        
    # Subgroups
    subgroups:
      - name: "프론트엔드팀"
        path: "frontend"
        description: "Frontend Development Team"
        
        members:
          - username: "frontend.lead"
            access_level: maintainer
          - username: "ui.developer1"
            access_level: developer
            
        projects:
          - name: "web-app"
            description: "Main web application"
            topics: ["react", "typescript"]
            settings:
              pages_enabled: true
              
          - name: "mobile-app"
            description: "Mobile application"
            topics: ["react-native", "mobile"]
            
        # Nested subgroups
        subgroups:
          - name: "웹개발파트"
            path: "web"
            description: "Web development part"
            
            projects:
              - name: "component-library"
                description: "Shared UI components"
                topics: ["components", "storybook"]
                settings:
                  packages_enabled: true

      - name: "백엔드팀"
        path: "backend"
        description: "Backend Development Team"
        visibility: internal
        
        members:
          - username: "backend.lead"
            access_level: maintainer
            
        projects:
          - name: "api-core"
            description: "Core API service"
            topics: ["nodejs", "api"]
            settings:
              container_registry_enabled: true
              
          - name: "auth-service"
            description: "Authentication service"
            topics: ["security", "oauth"]
            
        subgroups:
          - name: "인프라파트"
            path: "infrastructure"
            description: "Infrastructure and DevOps"
            
            projects:
              - name: "terraform-modules"
                description: "Infrastructure as Code"
                topics: ["terraform", "iac"]
              
              - name: "k8s-deployments"
                description: "Kubernetes configurations"
                topics: ["kubernetes", "helm"]

  - name: "보안팀"
    path: "security"
    description: "Security Team"
    visibility: private
    
    settings:
      emails_disabled: true
      mentions_disabled: true
      
    members:
      - username: "security.chief"
        access_level: owner
        
    projects:
      - name: "security-tools"
        description: "Security scanning tools"
        topics: ["security", "scanning"]
        visibility: private
        
      - name: "incident-response"
        description: "Incident response procedures"
        topics: ["security", "incidents"]

# Shared runners configuration
runners:
  - name: "docker-runner-1"
    tags: ["docker", "linux"]
    run_untagged: false
    locked: false
    groups: ["dev-division/frontend", "dev-division/backend"]
    
  - name: "k8s-runner-1"
    tags: ["kubernetes", "deployment"]
    run_untagged: false
    locked: true
    groups: ["dev-division/backend/infrastructure"]

# Group-level CI/CD variables
group_variables:
  - group_path: "dev-division"
    variables:
      - key: "ENVIRONMENT"
        value: "production"
        protected: true
        
  - group_path: "dev-division/backend"
    variables:
      - key: "DATABASE_URL"
        value: "postgresql://localhost/app"
        protected: true
        masked: true

# Compliance and audit settings
compliance:
  # Merge request approval rules
  approval_rules:
    - group_path: "dev-division"
      rule_name: "Security Review"
      approvals_required: 1
      groups: ["security"]
      
    - group_path: "dev-division/backend"
      rule_name: "Backend Review"
      approvals_required: 2
      users: ["backend.lead", "john.doe"]
      
  # Push rules
  push_rules:
    - group_path: "dev-division"
      commit_message_regex: "^(feat|fix|docs|style|refactor|test|chore):.+"
      branch_name_regex: "^(main|develop|feature/|bugfix/|hotfix/).+$"
      max_file_size: 100  # MB
      file_name_regex: "^[a-zA-Z0-9._-]+$"

# Automation options
automation:
  # Backup configuration
  backup:
    enabled: true
    schedule: "0 2 * * *"  # Daily at 2 AM
    retention_days: 30
    include_wiki: true
    include_issues: true
    include_lfs: true
    
  # Monitoring
  monitoring:
    enabled: true
    alerts_email: "devops@example.com"
    
  # License scanning
  license_scanning:
    enabled: true
    allowed_licenses: ["MIT", "Apache-2.0", "BSD-3-Clause"]
    denied_licenses: ["GPL-3.0", "AGPL-3.0"]

# Execution options
options:
  # Execution mode
  mode: "create"  # create, update, delete
  
  # Continue on error
  continue_on_error: true
  
  # Skip existing resources
  skip_existing: true
  
  # API rate limiting
  api_delay: 100  # milliseconds
  max_retries: 3
  
  # Parallel execution
  parallel_workers: 10
  
  # Dry run mode
  dry_run: false
  
  # Logging
  log_level: "info"  # debug, info, warn, error
  log_file: "organization-setup.log"